package com.open.test.perf

import io.gatling.core.scenario.Simulation
import io.gatling.core.Predef._
import io.gatling.http.Predef._
import java.util.Date
import scala.concurrent.duration.FiniteDuration
import scala.concurrent.duration.Duration
import java.util.concurrent.TimeUnit

class ApiGatlingSimulationTest extends Simulation {

  val sentHeaders = Map("Content-Type" -> "application/json", "Accept" -> "application/json")
  val jsonFileFeeder = jsonFile("input.json").circular
  
  val postMovies = scenario("PERF-POST").feed(jsonFileFeeder)
		  
      .exec(
        http("postMovies")
          .post("http://test.opentest.run/restapi/movies/")
          .headers(sentHeaders)
          .body(StringBody("""{"Title":${Title},"Year":${Year},"Rated":${Rated},"Released":${Released},"Type":${Type},"Runtime":${Runtime},"Genre":${Genre},"Director":${Director},"Writer":${Writer},"Actors":${Actors},"Plot":${Plot},"Language":${Language},"Country":${Country},"Awards":${Awards},"Poster":${Poster}}"""))
          .check(status.is(200))
      )

  setUp(postMovies.inject(atOnceUsers(2))).maxDuration(FiniteDuration.apply(1, "minutes"))
  
}