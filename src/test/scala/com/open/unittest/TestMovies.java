package com.open.unittest;

import static org.testng.Assert.assertEquals;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

import org.bson.types.ObjectId;
import org.json.simple.JSONArray;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.web.server.LocalServerPort;
import org.springframework.core.io.ClassPathResource;
import org.springframework.test.context.junit4.SpringRunner;

import com.fasterxml.jackson.databind.ObjectMapper;
import com.opentest.service.Movies;
import com.opentest.service.MoviesRESTController;
import com.opentest.service.OpenTestApplication;
@RunWith(SpringRunner.class)
@SpringBootTest(classes = OpenTestApplication.class, webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
public class TestMovies {
	@LocalServerPort
	private int port = 8082;

	@Value("${service.base.url}")
	protected String baseUrl;

	public String getRootUrl() {
		return baseUrl+":" + port;	
	}


//	@Test
//	public void testAddMovies() {
//		System.out.println("rootUrl: "+getRootUrl());
//		MoviesRESTController moviesRESTController = new MoviesRESTController();
//		List<Movies> moviesList = new ArrayList<Movies>();
//		JSONParser parser = new JSONParser();
//		ObjectMapper objectMapper = new ObjectMapper();
//		try {
//			File resource = new ClassPathResource(
//					"input.json").getFile();
//			JSONArray jSONArray = (JSONArray) parser.parse(new FileReader(resource.getAbsolutePath()));
//			//			System.out.println(jSONArray.get(0).toString());
//			int objCount=jSONArray.size();
//			for(int i=0; i<objCount; i++) {
//				//				System.out.println(jSONArray.get(i));
//				Movies movies = objectMapper.readValue(jSONArray.get(i).toString(), Movies.class);
//				ObjectId id = ObjectId.get();
//				System.out.println("objectId: "+id.toHexString());
//
//				movies.set_id(id);
//				moviesList.add(movies);
//			}
//		} catch (FileNotFoundException e1) {
//			e1.printStackTrace();
//		} catch (IOException e1) {
//			e1.printStackTrace();
//		} catch (ParseException e1) {
//			e1.printStackTrace();
//		}
//
//		for(Movies movies : moviesList) {
//			Movies createdMovie = moviesRESTController.createPet(movies);
//			assertEquals(createdMovie.get_id(), movies.get_id());
//		}
//
//	}

	@Test
	public void testGetMovies() {
		MoviesRESTController moviesRESTController = new MoviesRESTController();
		List<Movies> movies = moviesRESTController.getAllmovies();
		if(movies.size()>0) {
			for(Movies movie: movies) {
				System.out.println(movie.get_id());
			}
		}
	}

}
