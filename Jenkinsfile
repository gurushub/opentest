pipeline {
  agent any
  stages {
 stage('BUILD') {
      steps {
        sh 'mvn test jacoco:report'
        archiveArtifacts 'TEST*.xml,test*.xml,open*.jar,OPEN*.jar'
        publishHTML([allowMissing: false, alwaysLinkToLastBuild: true, keepAll: false, reportDir: 'target/surefire-reports/Open Test Suite/', reportFiles: 'Open Test Functional.html', reportName: 'Test Report', reportTitles: ''])
        publishHTML([allowMissing: false, alwaysLinkToLastBuild: true, keepAll: false, reportDir: 'target/site/jacoco/', reportFiles: 'index.html', reportName: 'TestCode Coverage', reportTitles: ''])
        //Builds, Tests and publishes the coverage report. 
          }
    }
/*
    stage('TEST') {
      steps {
        sh 'mvn test jacoco:report'
        archiveArtifacts 'TEST*.xml,test*.xml,open*.jar,OPEN*.jar'
        publishHTML([allowMissing: false, alwaysLinkToLastBuild: true, keepAll: false, reportDir: 'target/surefire-reports/Open Test Suite/', reportFiles: 'Open Test Functional.html', reportName: 'FunctionalTest Report', reportTitles: ''])
        publishHTML([allowMissing: false, alwaysLinkToLastBuild: true, keepAll: false, reportDir: 'target/site/jacoco/', reportFiles: 'index.html', reportName: 'Test Coverage Report', reportTitles: ''])
        }
    }*/

    stage('PERF-TESTS') {
      steps {
        sh 'mvn gatling:test'
        gatlingArchive()
      }
    }
    stage('KILL') {
      steps {
         sh 'lsof -i:8092'
      }
    }
  }
  tools {
    maven 'jenkins_maven'
  }
  }