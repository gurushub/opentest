pipeline {
  agent any
  stages {
    stage('INITIALIZE') {
      steps {
        sh '''
               echo "PATH = ${PATH}"
               echo "M2_HOME = ${M2_HOME}"
               mvn --version                
'''
        sh '''echo $JAVA_HOME
pwd'''
      }
    }
    stage('BUILD') {
      steps {
        //sh 'mvn clean test -Dsurefire.suiteXmlFiles=testng.xml'
        //sh 'mvn clean install -Dsurefire.suiteXmlFiles=testng.xml'
        mvn clean install -DskipTests
        sonar:sonar
        archiveArtifacts 'TEST*.xml,test*.xml,open*.jar,OPEN*.jar'
        publishHTML([allowMissing: false, alwaysLinkToLastBuild: true, keepAll: false, reportDir: 'test-output/', reportFiles: 'index.html', reportName: 'FunctionalTest Report', reportTitles: ''])
        }
    }

     stage('TEST') {
      steps {
        sonar:sonar
        archiveArtifacts 'TEST*.xml,test*.xml,open*.jar,OPEN*.jar'
        publishHTML([allowMissing: false, alwaysLinkToLastBuild: true, keepAll: false, reportDir: 'test-output/', reportFiles: 'index.html', reportName: 'FunctionalTest Report', reportTitles: ''])
        }
    }

    stage('PUBLISH') {
      steps {
        archiveArtifacts 'TEST*.xml,test*.xml,open*.jar,OPEN*.jar'
        publishHTML([allowMissing: false, alwaysLinkToLastBuild: true, keepAll: false, reportDir: 'test-output/', reportFiles: 'index.html', reportName: 'FunctionalTest Report', reportTitles: ''])
        }
    }

    stage('BENCHMARK') {
      steps {
        sh 'mvn gatling:test'
        gatlingArchive()
      }
    }
    stage('Post-Checks') {
      steps {
         sh 'pwd'
      }
    }
  }
  tools {
    maven 'jenkins_maven'
  }

  }